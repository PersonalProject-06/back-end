var Ae=Object.defineProperty,Le=Object.defineProperties;var Fe=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var ue=(t,a,o)=>a in t?Ae(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,H=(t,a)=>{for(var o in a||(a={}))ze.call(a,o)&&ue(t,o,a[o]);if(pe)for(var o of pe(a))Ne.call(a,o)&&ue(t,o,a[o]);return t},J=(t,a)=>Le(t,Fe(a));import{u as Y,r as l,j as r,C as Te,a as e,B as D,T as G,b as Pe,c as Ge,d as me,e as Oe,f as fe,g as W,V as Se,F as j,h as oe,I as ke,i as z,k as we,l as L,m as A,n as q,o as T,p as ae,q as _e,M as re,s as K,t as ne,v as X,w as se,x as Q,y as Re,z as ie,S as ve,A as M,D as le,E as Z,G as Ee,H as je,J as ge,K as xe,N as Ue,L as $e,O as We,P as ye,Q as ee,R as Ve,U as He,W as Je,X as Ye,Y as ce,Z as qe,_ as Ke,$ as Xe,a0 as Qe,a1 as Ze,a2 as et,a3 as tt,a4 as Ce,a5 as ot,a6 as at,a7 as rt,a8 as nt}from"./vendor.fcf5fb96.js";const st=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&s(p)}).observe(document,{childList:!0,subtree:!0});function o(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerpolicy&&(d.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?d.credentials="include":c.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(c){if(c.ep)return;c.ep=!0;const d=o(c);fetch(c.href,d)}};st();const it=()=>{const t=Y();return l.exports.useEffect(()=>{localStorage.getItem("userInfo")&&t("/chat")},[]),r(Te,{maxW:"xl",centerContent:!0,style:{color:"grey"},children:[e(D,{d:"flex",justifyContent:"center",p:3,bg:"white",w:"100%",m:"40px 0 15px 0",borderRadius:"lg",borderWidth:"1px",children:e(G,{fontSize:"4xl",fontFamily:"work sans",children:"Messanger"})}),e(D,{bg:"white",w:"100%",p:4,borderRadius:"lg",borderWidth:"1px",color:"black",children:r(Pe,{variant:"soft-rounded",children:[r(Ge,{mb:"1em",children:[e(me,{width:"50%",children:"Login"}),e(me,{width:"50%",children:"Sign Up"})]}),r(Oe,{children:[e(fe,{children:e(dt,{})}),e(fe,{children:e(ht,{})})]})]})})]})},O=l.exports.createContext(),lt=({children:t})=>{const a=Y(),[o,s]=l.exports.useState(null),[c,d]=l.exports.useState(null),[p,x]=l.exports.useState([]),[S,B]=l.exports.useState([]);return l.exports.useEffect(()=>{const y=localStorage==null?void 0:localStorage.getItem("userInfo");y?(s(JSON.parse(y)),a("/chat")):a("/")},[a]),e(O.Provider,{value:{user:o,setUser:s,setSlectedChat:d,slectedChat:c,chats:p,setChats:x,notifications:S,setNotifications:B},children:t})},ct=()=>{const{user:t,setSlectedChat:a,chats:o,setChats:s,slectedChat:c}=l.exports.useContext(O),[d,p]=l.exports.useState(!1);return r("div",{style:{width:"100%"},children:[t&&e(pt,{}),r(D,{d:"flex",justifyContent:"space-between",w:"100%",h:"91.5vh",p:"10px",children:[t&&e(zt,{fetchAgain:d}),t&&e(Lt,{fetchAgain:d,setFetchAgain:p})]})]})},dt=()=>{const t=Y(),[a,o]=l.exports.useState(!1),[s,c]=l.exports.useState(!1),[d,p]=l.exports.useState({email:"",password:""}),x=W(),S=(k,n)=>p(i=>J(H({},i),{[n]:k})),B=[{name:"email",placeholder:"Email",handleChange:S,type:"text"},{name:"password",placeholder:"Password",handleChange:S,type:"password"}],y=async()=>{if(c(!0),d.email.length==0&&d.password.length==0){x({title:"Please Fill all the fields",status:"warning",duration:5e3,isClosable:!0,position:"bottom"}),c(!1);return}try{const k={"Content-type":"application/json"},{email:n,password:i}=d,{data:u}=await A.post("/api/user/login/",{email:n,password:i},k);localStorage.setItem("userInfo",JSON.stringify(u)),x({title:"Login Successful ",status:"success",duration:5e3,isClosable:!0,position:"bottom"}),c(!1),t("/chat")}catch{x({title:"An Error Occured ",status:"warning",duration:5e3,isClosable:!0,position:"bottom"}),c(!1)}};return r(Se,{spacing:"5px",color:"black",children:[B.map(({name:k,placeholder:n,handleChange:i,type:u},g)=>r(j,{id:"first-name",isRequired:!0,children:[e(oe,{children:n}),k=="password"?r(ke,{children:[e(z,{type:a?"text":u,placeholder:n,name:k,onChange:b=>i(b.target.value,b.target.name)}),e(we,{width:"4.5rem",children:e(L,{h:"1.75rem",size:"sm",onClick:()=>o(!a),children:a?"Hide":"Show"})})]}):e(z,{placeholder:n,name:k,onChange:b=>i(b.target.value,b.target.name),type:u})]},g+k)),e(L,{colorScheme:"blue",width:"100%",style:{marginTop:15},onClick:y,isLoading:s,children:"Login"})]})},ht=()=>{const[t,a]=l.exports.useState(!1),[o,s]=l.exports.useState(!1),c=Y(),[d,p]=l.exports.useState({name:"",email:"",password:"",confirmPassword:"",pic:""}),x=(n,i)=>p(u=>J(H({},u),{[i]:n})),S=W(),B=[{name:"name",placeholder:"Name",handleChange:x,type:"text"},{name:"email",placeholder:"Email",handleChange:x,type:"text"},{name:"password",placeholder:"Password",handleChange:x,type:"password"},{name:"confirmPassword",placeholder:"Confirm Password",handleChange:x,type:"password"}],y=n=>{if(s(!0),n===void 0){S({title:"Please Select an Image!.",status:"warning",duration:5e3,isClosable:!0,position:"bottom"}),s(!1);return}if(n.type==="image/jpeg"||n.type==="image/png"){const i=new FormData;i.append("file",n),i.append("upload_preset","chatApp"),i.append("cloud_name","daseuavqf"),fetch("https://api.cloudinary.com/v1_1/daseuavqf/image/upload",{method:"post",body:i}).then(u=>u.json()).then(u=>{p(g=>J(H({},g),{pic:u.url.toString()})),s(!1)}).catch(u=>{console.log(u),s(!1)})}else{S({title:"Please Select an Image!.",status:"warning",duration:5e3,isClosable:!0,position:"bottom"});return}},k=async()=>{if(s(!0),d.email.length==0&&d.name.length==0&&d.password.length==0&&d.confirmPassword.length==0){S({title:"Please Fill all the fields",status:"warning",duration:5e3,isClosable:!0,position:"bottom"}),s(!1);return}if(d.password!==d.confirmPassword){S({title:"Password do not match",status:"warning",duration:5e3,isClosable:!0,position:"bottom"}),s(!1);return}try{const n={"Content-type":"application/json"},{name:i,email:u,password:g,pic:b}=d,{data:_}=await A.post("/api/user/",{name:i,email:u,password:g,pic:b},n);S({title:"Registration Successful ",status:"success",duration:5e3,isClosable:!0,position:"bottom"}),localStorage.setItem("userInfo",JSON.stringify(_)),s(!1),c("/chat")}catch{S({title:"An Error Occured ",status:"warning",duration:5e3,isClosable:!0,position:"bottom"}),s(!1)}};return r(Se,{spacing:"5px",color:"black",children:[B.map(({name:n,placeholder:i,handleChange:u,type:g},b)=>r(j,{id:"first-name",isRequired:!0,children:[e(oe,{children:i}),n=="confirmPassword"||n=="password"?r(ke,{children:[e(z,{type:t?"text":g,placeholder:i,name:n,onChange:_=>u(_.target.value,_.target.name)}),e(we,{width:"4.5rem",children:e(L,{h:"1.75rem",size:"sm",onClick:()=>a(!t),children:t?"Hide":"Show"})})]}):e(z,{placeholder:i,name:n,onChange:_=>u(_.target.value,_.target.name),type:g})]},b)),r(j,{id:"pic",children:[e(oe,{children:"Picture"}),e(z,{type:"file",p:1.5,accept:"image/*",name:"pic",onChange:n=>y(n.target.files[0])})]}),e(L,{colorScheme:"blue",width:"100%",style:{marginTop:15},onClick:()=>k(),isLoading:o,children:"Sign Up"})]})};var be="/assets/search.72c78d4b.svg";const Ie=({name:t,pic:a,email:o,user:s,children:c})=>{if(s)var{name:t,pic:a,email:o}=s;const{isOpen:d,onOpen:p,onClose:x}=q();return r(T,{children:[c?e("span",{onClick:p,children:c}):e(ae,{d:{base:"flex"},icon:e(_e,{}),onClick:p}),r(re,{size:"lg",isOpen:d,onClose:x,children:[e(K,{}),r(ne,{h:"410px",children:[e(X,{fontSize:"40px",fontFamily:"Work sans",d:"flex",justifyContent:"center",children:t}),e(se,{}),r(Q,{d:"flex",flexDir:"column",alignItems:"center",justifyContent:"space-between",children:[e(Re,{borderRadius:"full",boxSize:"150px",alt:t,src:a}),r(G,{fontSize:{base:"28px",md:"30px"},fontFamily:"Work Sans",children:["Email: ",o]})]}),e(ie,{children:e(L,{colorScheme:"blue",mr:3,onClick:x,children:"Close"})})]})]})]})},De=()=>r(ve,{children:[e(M,{height:"45px"}),e(M,{height:"45px"}),e(M,{height:"45px"}),e(M,{height:"45px"}),e(M,{height:"45px"}),e(M,{height:"45px"}),e(M,{height:"45px"}),e(M,{height:"45px"}),e(M,{height:"45px"}),e(M,{height:"45px"}),e(M,{height:"45px"}),e(M,{height:"45px"}),e(M,{height:"45px"})]}),de=({handleFunction:t,user:a})=>{const{name:o,pic:s,email:c}=a;return r(D,{onClick:t,cursor:"pointer",bg:"#E8E8E8",_hover:{background:"#38B2AC",color:"#fff"},w:"100%",d:"flex",alignItems:"center",color:"black",px:3,py:2,mb:2,borderRadius:"lg",children:[e(le,{mr:2,size:"sm",cursor:"pointer",name:o,src:s}),r(D,{children:[e(G,{children:o}),r(G,{fontSize:"xs",children:[e("b",{children:"Email:"}),c]})]})]})},pt=()=>{const t=W(),[a,o]=l.exports.useState(""),[s,c]=l.exports.useState([]),[d,p]=l.exports.useState(!1),[x,S]=l.exports.useState(null),{colorMode:B,toggleColorMode:y}=Z(),{user:{_id:k,name:n,pic:i,email:u,token:g},setSlectedChat:b,chats:_,setChats:U,notifications:C,setNotifications:P}=l.exports.useContext(O),{isOpen:$,onOpen:R,onClose:f}=q(),v=()=>{localStorage.removeItem("userInfo"),window.location.reload()},m=(h,I)=>I[0]._id===h._id?I[1].name:I[0].name,w=async()=>{if(a===""){t({title:"Please Fill  the search fields",status:"warning",duration:5e3,isClosable:!0,position:"top-left"});return}try{p(!0);const h={headers:{Authorization:`Bearer ${g}`}},{data:I}=await A.get(`/api/user/?search=${a}`,h);p(!1),c(I);return}catch{t({title:"Something went wrong try again!",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"}),p(!1);return}},N=async h=>{try{S(!0);const I={headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`}},{data:V}=await A.post("/api/chat/",{userId:h},I);_.find(he=>he._id===V._id)||U([V,..._]),b(V),S(!1),f()}catch(I){console.log(I),t({title:"Something went wrong try again!",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"})}};return r(T,{children:[r(D,{d:"flex",justifyContent:"space-between",alignItems:"center",bg:B==="light"?"white":"gray.800",w:"100%",p:"5px 10px",borderWidth:"5px",children:[e(Ee,{label:"Search Users to chat",hasArrow:!0,placement:"bottom-end",children:r(L,{variant:"ghost",onClick:R,children:[e("img",{src:be,style:{width:"20px"}}),e(G,{d:{base:"none",md:"flex"},px:"4",children:"Search Users"})]})}),e(G,{fontSize:"2xl",fontFamily:"Work sans",children:"Messanger"}),r("div",{children:[e(je,{colorScheme:"teal",size:"md",isChecked:B!=="light",onChange:h=>{y()}}),r(ge,{children:[r(xe,{p:1,children:[e(Ue,{count:C.length,effect:$e.Effect.SCALE}),e(We,{fontSize:"2xl",m:"1"})]}),r(ye,{pl:2,children:[!C.length&&"No New Messages",C.map(h=>e(ee,{onClick:()=>{b(h.chat),P(C.filter(I=>I!==h))},children:h.chat.isGroupChat?`New Message in ${h.chat.chatName}`:`New Message from ${m({_id:k,name:n},h.chat.users)}`},h._id))]})]}),r(ge,{children:[" ",e(xe,{as:L,rightIcon:e(Ve,{}),children:e(le,{size:"sm",cursor:"pointer",name:n,src:i})}),r(ye,{children:[e(Ie,{name:n,pic:i,email:u,children:e(ee,{children:"My Profile"})}),e(He,{}),e(ee,{onClick:v,children:"Logout"})]})]})]})]}),r(Je,{placement:"left",onClose:f,isOpen:$,children:[e(K,{}),r(Ye,{children:[e(X,{borderBottomWidth:"1px",children:"Search Users"}),r(Q,{children:[r(D,{d:"flex",pb:"2",children:[e(z,{placeholder:"Search by name or email",mr:"2",value:a,onChange:h=>o(h.target.value)}),e(L,{onClick:w,isLoading:d,children:e("img",{src:be,style:{width:"20px"}})})]}),d?e(De,{}):s==null?void 0:s.map(h=>e(de,{user:h,handleFunction:()=>N(h._id)},h._id)),x&&e(ce,{ml:"auto",d:"flex"})]})]})]})]})},ut="5.4.2",mt=29.9700012207031,ft=0,gt=50.0000020365418,xt=500,yt=500,Ct="Comp 1",bt=0,St=[],kt=[{ddd:0,ind:1,ty:4,nm:"Shape Layer 4",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[474.25,250,0],ix:2},a:{a:1,k:[{i:{x:.667,y:1},o:{x:.333,y:0},n:"0p667_1_0p333_0",t:8,s:[0,0,0],e:[0,60,0],to:[0,10,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.333,y:0},n:"0p667_1_0p333_0",t:17,s:[0,60,0],e:[0,0,0],to:[0,0,0],ti:[0,10,0]},{t:26.0000010590017}],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[65.719,65.719],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"st",c:{a:0,k:[.721415441176,.721415441176,.721415441176,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:0,ix:5},lc:1,lj:1,ml:4,ml2:{a:0,k:4,ix:8},nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"fl",c:{a:0,k:[.54309129902,.54309129902,.54309129902,1],ix:4},o:{a:0,k:100,ix:5},r:1,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[-112,-2],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Ellipse 1",np:3,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:900.000036657751,st:0,bm:0},{ddd:0,ind:2,ty:4,nm:"Shape Layer 2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[362,250,0],ix:2},a:{a:1,k:[{i:{x:.667,y:1},o:{x:.333,y:0},n:"0p667_1_0p333_0",t:4,s:[0,0,0],e:[0,60,0],to:[0,10,0],ti:[0,0,0]},{i:{x:.833,y:.833},o:{x:.333,y:0},n:"0p833_0p833_0p333_0",t:13,s:[0,60,0],e:[0,0,0],to:[0,0,0],ti:[0,10,0]},{t:22.0000008960784}],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[65.719,65.719],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"st",c:{a:0,k:[.721415441176,.721415441176,.721415441176,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:0,ix:5},lc:1,lj:1,ml:4,ml2:{a:0,k:4,ix:8},nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"fl",c:{a:0,k:[.54309129902,.54309129902,.54309129902,1],ix:4},o:{a:0,k:100,ix:5},r:1,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[-112,-2],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Ellipse 1",np:3,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:900.000036657751,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"Shape Layer 1",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[250,250,0],ix:2},a:{a:1,k:[{i:{x:.667,y:1},o:{x:.333,y:0},n:"0p667_1_0p333_0",t:0,s:[0,0,0],e:[0,60,0],to:[0,10,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.333,y:0},n:"0p667_1_0p333_0",t:9,s:[0,60,0],e:[0,0,0],to:[0,0,0],ti:[0,10,0]},{t:18.000000733155}],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[65.719,65.719],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"st",c:{a:0,k:[.721415441176,.721415441176,.721415441176,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:0,ix:5},lc:1,lj:1,ml:4,ml2:{a:0,k:4,ix:8},nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"fl",c:{a:0,k:[.54309129902,.54309129902,.54309129902,1],ix:4},o:{a:0,k:100,ix:5},r:1,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[-112,-2],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Ellipse 1",np:3,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:900.000036657751,st:0,bm:0}],wt=[];var _t={v:ut,fr:mt,ip:ft,op:gt,w:xt,h:yt,nm:Ct,ddd:bt,assets:St,layers:kt,markers:wt};const Be=({user:t,handleFunction:a})=>r(D,{px:2,py:1,borderRadius:"lg",m:1,mb:2,variant:"solid",fontSize:12,backgroundColor:"blue",color:"white",cursor:"pointer",onClick:a,children:[t.name,e(qe,{pl:1})]}),vt=({fetchAgain:t,setFetchAgain:a,fetchMessages:o})=>{var v;const[s,c]=l.exports.useState(),[d,p]=l.exports.useState(""),[x,S]=l.exports.useState([]),[B,y]=l.exports.useState(!1),[k,n]=l.exports.useState(!1),{user:i,setSlectedChat:u,slectedChat:g}=l.exports.useContext(O),b=W(),{isOpen:_,onOpen:U,onClose:C}=q(),P=async m=>{if(g.groupAdmin._id!==i._id&&m._id!==i._id)return b({title:"Only admin can remove this user",status:"error",duration:9e3,isClosable:!0,position:"bottom"});try{y(!0);const w={headers:{Authorization:`Bearer ${i.token}`}},{data:N}=await A.post("/api/chat/deletegroup",{chatId:g._id,userId:m._id},w);m._id===i._id?u():u(N),y(!1),a(!t),o()}catch(w){return console.log(w),y(!1),b({title:"Error",status:"somthing went wrong",duration:9e3,isClosable:!0,position:"bottom"})}},$=async m=>{if(g.users.find(w=>w.id===m.id)){b({title:"User already in group chat",status:"error",duration:5e3,isClosable:!0,position:"bottom"});return}g.groupAdmin._id!==i.id&&b({title:"You are not group admin",status:"error",duration:5e3,isClosable:!0,position:"bottom"});try{y(!0);const w={headers:{Authorization:`Bearer ${i.token}`}},{data:N}=await A.post("/api/chat/addgroup",{chatId:g._id,userId:m._id},w);y(!1),u(N),a(!t)}catch{y(!1),b({title:"Error",description:"Something went wrong",status:"error",duration:9e3,isClosable:!0,position:"bottom"})}},R=async m=>{if(p(m),!!m)try{y(!0);const w={headers:{Authorization:`Bearer ${i.token}`}},{data:N}=await A.get(`/api/user?search=${m}`,w);y(!1),S(N)}catch{return b({title:"Failed to load the chat",description:"Failed to load the search result",status:"error",duration:5e3,isClosable:!0,position:"bottom"}),y(!1)}},f=async()=>{if(!!s)try{n(!0);const m={headers:{Authorization:`Bearer ${i.token}`}},{data:w}=await A.put("/api/chat/renamegroup",{chatName:s,chatId:g._id},m);return n(!1),u(w),a(!t),c("")}catch(m){return n(!1),console.log(m),b({title:"Error",description:"Something went wrong",status:"error",duration:9e3,isClosable:!0,position:"bottom"})}};return r(T,{children:[e(ae,{d:{base:"flex"},icon:e(_e,{}),onClick:U}),r(re,{isOpen:_,onClose:C,isCentered:!0,children:[e(K,{}),r(ne,{children:[e(X,{fontSize:"35px",fontFamily:"Work sans",d:"flex",justifyContent:"center",children:g==null?void 0:g.chatName}),e(se,{}),r(Q,{children:[e(D,{w:"100%",d:"flex",flexWrap:"wrap",pb:3,children:(v=g==null?void 0:g.users)==null?void 0:v.map((m,w)=>e(Be,{user:m,handleFunction:()=>P(m)},w**w))}),r(j,{d:"flex",children:[e(z,{placeholder:"Chat name",mb:3,value:s,onChange:m=>c(m.target.value)}),e(L,{variant:"solid",colorScheme:"teal",ml:"1",isLoading:k,onClick:f,children:"Update"})]}),e(j,{children:e(z,{placeholder:"add user to group",mb:1,onChange:m=>R(m.target.value)})}),B?e(ce,{size:"lg"}):x==null?void 0:x.map((m,w)=>e(de,{user:m,handleFunction:()=>$(m)}))]}),e(ie,{children:e(L,{colorScheme:"red",mr:3,onClick:()=>P(i),children:"Leave the Group"})})]})]})]})},Et=(t,a,o,s)=>o<t.length-1&&(t[o+1].sender._id!==a.sender._id||t[o+1].sender._id===void 0)&&t[o].sender._id!==s,It=(t,a,o)=>a===t.length-1&&t[t.length-1].sender._id!==o&&t[t.length-1].sender._id,Dt=(t,a,o,s)=>o<t.length-1&&t[o+1].sender._id===a.sender._id&&t[o].sender._id!==s?33:o<t.length-1&&t[o+1].sender._id!==a.sender._id&&t[o].sender._id!==s||o===t.length-1&&t[o].sender._id!==s?0:"auto",Bt=(t,a,o)=>o>0&&t[o-1].sender._id===a.sender._id,Mt=({messages:t})=>{const{user:a}=l.exports.useContext(O);return e(Ke,{children:t==null?void 0:t.map((o,s)=>r("div",{style:{display:"flex"},children:[(Et(t,o,s,a._id)||It(t,s,a._id))&&e(Ee,{label:o.sender.name,placement:"bottom-start",hasArrow:!0,children:e(le,{mt:"7px",mr:1,size:"sm",cursor:"pointer",name:o.sender.name,src:o.sender.pic})}),e("span",{style:{backgroundColor:o.sender._id===a._id?"#BEE3F8":"#B9F5D0",borderRadius:"20px",padding:"5px 15px",maxWidth:"75%",marginLeft:Dt(t,o,s,a._id),marginTop:Bt(t,o,s,a._id)?3:10},children:o.content})]},o._id))})},Me="https://morning-falls-66881.herokuapp.com";console.log(Me);let F,te;const At=({fetchAgain:t,setFetchAgain:a})=>{var N;const[o,s]=l.exports.useState([]),[c,d]=l.exports.useState(!1),[p,x]=l.exports.useState(""),[S,B]=l.exports.useState(!1),[y,k]=l.exports.useState(!1),[n,i]=l.exports.useState(!1),{colorMode:u,toggleColorMode:g}=Z(),b=W(),{user:_,setSlectedChat:U,slectedChat:C,notifications:P,setNotifications:$}=l.exports.useContext(O),R=(E,h)=>h[0]._id===E._id?h[1].name:h[0].name,f=(E,h)=>h[0]._id===E._id?h[1]:h[0],v=async()=>{if(!!C)try{d(!0);const E={headers:{Authorization:`Bearer ${_.token}`}},{data:h}=await A.get(`/api/message/${C._id}`,E);s(h),d(!1),F.emit("join chat",C._id)}catch{d(!1),b({title:"Something went wrong try again!",status:"error",duration:5e3,isClosable:!0,position:"bottom"})}},m=async E=>{if(E.key==="Enter"){F.emit("stop typing",C._id);try{const h={headers:{"Content-Type":"application/json",Authorization:`Bearer ${_.token}`}};x("");const{data:I}=await A.post("/api/message",{content:p,chatId:C._id},h);F.emit("new message",I),s([...o,I])}catch{b({title:"Something went wrong try again!",status:"error",duration:5e3,isClosable:!0,position:"bottom"})}}};console.log(P);const w=E=>{if(x(E.target.value),!S)return;y||(k(!0),F.emit("typing",C._id));let h=new Date().getTime(),I=3e3;setTimeout(()=>{new Date().getTime()-h>=I&&y&&(F.emit("stop typing",C._id),k(!1))},I)};return l.exports.useEffect(()=>{F=Xe(Me),F.emit("setup",_),F.on("connected",E=>B(!0)),F.on("typing",()=>i(!0)),F.on("stop typing",()=>i(!1))},[]),l.exports.useEffect(()=>{v(),te=C},[C]),l.exports.useEffect(()=>{F.on("message recived",E=>{!te||te._id!==E.chat._id?P.includes(E)||($([...o,E]),a(!t)):s([...o,E])})}),e(T,{children:C?r(T,{children:[r(G,{fontSize:{base:"28px",md:"30px"},pb:3,px:2,w:"100%",fontFamily:"Work Sans",d:"flex",justifyContent:{base:"space-between"},alignItems:"center",children:[e(ae,{d:{base:"flex",md:"none"},icon:e(Qe,{}),onClick:()=>U(null)}),C!=null&&C.isGroupChat?r(T,{children:[(N=C==null?void 0:C.chatName)==null?void 0:N.toUpperCase(),e(vt,{fetchAgain:t,setFetchAgain:a,fetchMessages:v})]}):r(T,{children:[R(_,C.users),e(Ie,{user:f(_,C.users)})]})]}),r(D,{d:"flex",flexDir:"column",justifyContent:"flex-end",p:3,bg:u==="dark"?"#2D3748":"#E8E8E8",w:"100%",h:"100%",borderRadius:"lg",overflowY:"hidden",color:"#000",children:[c?e(ce,{size:"xl",w:20,h:20,alignSelf:"center",margin:"auto"}):e("div",{className:"messages",children:e(Mt,{messages:o})}),r(j,{onKeyDown:m,isRequired:!0,mt:3,children:[n?e("div",{children:e(Ze,{options:{loop:!0,autoplay:!0,animationData:_t,rendererSettings:{preserveAspectRatio:"xMidYMid slice"}},width:70,style:{marginBottom:15,marginLeft:0}})}):e(T,{}),e(z,{variant:"filled",color:u==="dark"?"#fff":"#E8E8E8",bg:u==="dark"?"#4A5568":"#E8E8E8",placeholder:"Type a message",value:p,onChange:w})]})]})]}):e(T,{children:e(D,{d:"flex",alignItems:"center",justifyContent:"center",h:"100%",children:r(G,{fontSize:"3xl",pb:3,fontFamily:"Work sans",children:["Click on a user to start chat"," "]})})})})},Lt=({fetchAgain:t,setFetchAgain:a})=>{const{colorMode:o}=Z(),{slectedChat:s}=l.exports.useContext(O);return e(D,{d:{base:s?"flex":"none",md:"flex"},flexDir:"column",alignItems:"center",p:3,bg:o==="light"?"white":"gray.800",w:{base:"100%",md:"68%"},borderRadius:"lg",borderWidth:"1px",children:e(At,{fetchAgain:t,setFetchAgain:a})})},Ft=({children:t})=>{var R;const{isOpen:a,onOpen:o,onClose:s}=q(),[c,d]=l.exports.useState(null),[p,x]=l.exports.useState([]),[S,B]=l.exports.useState(),[y,k]=l.exports.useState([]),[n,i]=l.exports.useState(!1),u=W(),{user:{token:g},chats:b,setChats:_}=l.exports.useContext(O),U=async f=>{if(B(f),!!f)try{i(!0);const v={headers:{Authorization:`Bearer ${g}`}},{data:m}=await A.get(`/api/user?search=${f}`,v);i(!1),k(m)}catch{return u({title:"Failed to load the chat",description:"Failed to load the search result",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"}),i(!1)}},C=f=>{if(p.includes(f)){u({title:"User already added",status:"warning",duration:5e3,isClosable:!0,position:"bottom-left"});return}x(v=>[...v,f])},P=f=>{x(v=>v.filter(m=>m._id!==f))},$=async()=>{if(!c||!p){u({title:"Please fill the fields",status:"warning",duration:5e3,isClosable:!0,position:"top"});return}try{i(!0);const f={headers:{Authorization:`Bearer ${g}`}},{data:v}=await A.post("/api/chat/group",{name:c,users:JSON.stringify(p.map(({_id:m})=>m))},f);_([v,...b]),s(),i(!1),u({title:"Group chat created successfully",status:"success",duration:5e3,isClosable:!0,position:"bottom"});return}catch{u({title:"Failed to create the group chat",status:"error",duration:5e3,isClosable:!0,position:"bottom"}),i(!1);return}};return r(T,{children:[e("span",{onClick:o,children:t}),r(re,{blockScrollOnMount:!1,isOpen:a,onClose:s,children:[e(K,{}),r(ne,{children:[e(X,{fontSize:"35px",fontFamily:"Work sans",d:"flex",justifyContent:"center",children:"Create Group Chat"}),e(se,{}),r(Q,{d:"flex",flexDir:"column",alignItems:"center",children:[e(j,{children:e(z,{placeholder:"Group Chat Name",mb:3,onChange:f=>d(f.target.value)})}),e(j,{children:e(z,{placeholder:"Add Users eg: achref, tarek, firas",mb:3,onChange:f=>U(f.target.value)})}),e(D,{width:"100%",d:"flex",flexWrap:"wrap",children:p==null?void 0:p.map(f=>e(Be,{user:f,handleFunction:()=>P(f._id)},f._id))}),n?e("div",{}):(R=y==null?void 0:y.slice(0,4))==null?void 0:R.map((f,v)=>e(de,{user:f,handleFunction:()=>C(f)},v))]}),e(ie,{children:e(L,{colorScheme:"blue",onClick:$,isLoading:n,children:"create groupe chat"})})]})]})]})},zt=({fetchAgain:t})=>{const{colorMode:a}=Z(),[o,s]=l.exports.useState(null),{user:{token:c},setSlectedChat:d,chats:p,setChats:x,slectedChat:S}=l.exports.useContext(O),B=W(),y=async()=>{try{const n={headers:{Authorization:`Bearer ${c}`}},{data:i}=await A.get("/api/chat/",n);x(i)}catch(n){console.log(n),B({title:"Failed to load the chat",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"});return}};l.exports.useEffect(()=>{s(JSON.parse(localStorage.getItem("userInfo"))),y()},[t]);const k=(n,i)=>i[0]._id===n._id?i[1].name:i[0].name;return r(D,{d:{base:S?"none":"flex",md:"flex"},flexDir:"column",alignItems:"center",p:3,bg:a==="light"?"white":"gray.800",w:{base:"100%",md:"31%"},borderRadius:"lg",borderWidth:"1px",children:[r(D,{pb:3,px:3,fontSize:{base:"28px",md:"30px"},fontFamily:"work-sans",d:"flex",w:"100%",justifyContent:"space-between",alignItems:"center",children:["My Chats",e(Ft,{children:e(L,{d:"flex",fontSize:{base:"17px",md:"10px",lg:"17px"},rightIcon:e(et,{}),children:"New Group Chat"})})]}),e(D,{d:"flex",flexDir:"column",p:3,bg:a==="light"?"white":"gray.800",w:"100%",h:"100%",borderRadius:"lg",overflow:"hidden",children:p.length?e(ve,{overflowX:"auto",children:p.map(n=>e(D,{onClick:()=>d(n),cursor:"pointer",bg:S===n?"#38B2AC":"#E8E8E8",color:S===n?"white":"black",px:3,py:2,borderRadius:"lg",children:e(G,{children:n!=null&&n.isGroupChat?n==null?void 0:n.chatName:k(o,n.users)})},n._id))}):e(De,{})})]})};function Nt(){return e("div",{className:"App",children:r(tt,{children:[e(Ce,{path:"/",element:e(it,{})}),e(Ce,{path:"/chat",element:e(ct,{})})]})})}ot.render(e(at.StrictMode,{children:e(rt,{children:e(lt,{children:e(nt,{children:e(Nt,{})})})})}),document.getElementById("root"));
